<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏</title>
<meta name="description" content="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–π –∏–ª–ª—é–∑–∏–æ–Ω–∏—Å—Ç–∞">
<meta name="theme-color" content="#000000">

<!-- iOS PWA -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä">
<link rel="manifest" href="manifest.json">

<!-- Preload critical resources -->
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<!-- Critical CSS inline –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ -->
<style>
/* –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ */
body { margin: 0; background: #000; color: #EEE; font-family: -apple-system, sans-serif; }
.header { padding: 12px 16px; background: rgba(15, 16, 20, 0.95); border-bottom: 1px solid rgba(255,255,255,0.14); }
.header h1 { margin: 0; font-size: 20px; color: #CBA135; text-align: center; }
</style>

<style>
:root {
  --bg: #000;
  --text: #EEE;
  --gold: #CBA135;
  --gold2: #E7C776;
  --panel: rgba(15, 16, 20, 0.95);
  --border: rgba(255, 255, 255, 0.14);
  --input-bg: #15171e;
  --input-border: #2f3138;
  --r: 12px;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
  display: flex;
  flex-direction: column;
  -webkit-font-smoothing: antialiased;
}

.header {
  padding: 12px 16px;
  text-align: center;
  border-bottom: 1px solid var(--border);
  background: var(--panel);
  backdrop-filter: blur(20px);
}

.header h1 {
  font-size: clamp(18px, 4.5vw, 20px);
  font-weight: 900;
  color: var(--gold);
  letter-spacing: 0.05em;
}

.container {
  flex: 1;
  padding: 16px 12px 12px;
  max-width: 600px;
  margin: 0 auto;
  width: 100%;
}

.form-group {
  margin-bottom: 12px;
}

label {
  display: block;
  margin-bottom: 6px;
  font-weight: 600;
  font-size: 14px;
  color: var(--gold2);
}

select {
  width: 100%;
  padding: 14px 40px 14px 14px;
  border-radius: var(--r);
  background: var(--input-bg);
  border: 2px solid var(--input-border);
  color: var(--text);
  font-size: 16px;
  font-weight: 500;
  appearance: none;
  cursor: pointer;
  background-image: url('data:image/svg+xml;utf8,<svg fill="%23CBA135" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg>');
  background-repeat: no-repeat;
  background-position: right 10px center;
  background-size: 24px;
  transition: all 0.2s;
}

select:focus {
  outline: none;
  border-color: var(--gold);
  box-shadow: 0 0 0 3px rgba(203, 161, 53, 0.15);
}

select:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.result {
  margin-top: 16px;
  padding: 16px;
  border-radius: var(--r);
  background: linear-gradient(135deg, rgba(203, 161, 53, 0.1), rgba(231, 199, 118, 0.05));
  border: 2px solid var(--gold);
  display: none;
}

.result.show {
  display: block;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

.total {
  font-size: clamp(32px, 8vw, 42px);
  font-weight: 900;
  color: var(--gold);
  text-align: center;
  margin-bottom: 12px;
  letter-spacing: 0.02em;
}

.breakdown {
  font-size: 14px;
  line-height: 1.6;
  color: #cfcfcf;
}

.breakdown-item {
  display: flex;
  justify-content: space-between;
  padding: 6px 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.breakdown-item:last-child {
  border-bottom: none;
  margin-top: 6px;
  padding-top: 8px;
  border-top: 2px solid var(--gold);
  font-weight: 700;
  color: var(--gold2);
  font-size: 15px;
}

.label-text {
  color: #999;
}

.value-text {
  font-weight: 600;
  color: var(--text);
}

.footer {
  padding: 12px 16px;
  text-align: center;
  font-size: 12px;
  color: #666;
  border-top: 1px solid var(--border);
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø—É–ª—å—Å–∞—Ü–∏–∏ –¥–ª—è —Å—É–º–º—ã */
@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.total.pulse {
  animation: pulse 0.5s ease;
}

/* –û—Ñ–ª–∞–π–Ω –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä */
.offline-badge {
  position: fixed;
  top: calc(env(safe-area-inset-top) + 8px);
  right: 8px;
  background: rgba(255, 193, 7, 0.95);
  color: #000;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 700;
  z-index: 100;
  display: none;
  backdrop-filter: blur(10px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.offline-badge.show {
  display: block;
  animation: slideIn 0.3s ease;
}

@keyframes slideIn {
  from { transform: translateX(120%); }
  to { transform: translateX(0); }
}
</style>
</head>
<body>

<div class="offline-badge" id="offlineBadge">üì° –û—Ñ–ª–∞–π–Ω</div>

<div class="header">
  <h1>üé© –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏</h1>
</div>

<div class="container">
  <form id="calcForm">
    <div class="form-group">
      <label for="area">–û–±–ª–∞—Å—Ç—å</label>
      <select id="area" required autofocus>
        <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å</option>
      </select>
    </div>

    <div class="form-group">
      <label for="city">–ì–æ—Ä–æ–¥</label>
      <select id="city" disabled required>
        <option value="" disabled selected>–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å</option>
      </select>
    </div>

    <div class="form-group">
      <label for="service">–£—Å–ª—É–≥–∞</label>
      <select id="service" required>
        <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É</option>
      </select>
    </div>
  </form>

  <div class="result" id="result">
    <div class="total" id="totalPrice">0 ‚ÇΩ</div>
    <div class="breakdown" id="breakdown"></div>
  </div>
</div>

<div class="footer">
  ¬© 2025 –î–º–∏—Ç—Ä–∏–π –ö–æ—Å—Ç—é–∫
</div>

<script>
// –î–∞–Ω–Ω—ã–µ –ª–æ–≥–∏—Å—Ç–∏–∫–∏
const logistics = {
  "–Ø—Ä–æ—Å–ª–∞–≤—Å–∫–∞—è": {
    "–Ø—Ä–æ—Å–ª–∞–≤–ª—å": { km: 0, price: 0 },
    "–†—ã–±–∏–Ω—Å–∫": { km: 160, price: 1500 },
    "–¢—É—Ç–∞–µ–≤": { km: 80, price: 1000 },
    "–ü–µ—Ä–µ—Å–ª–∞–≤–ª—å-–ó–∞–ª–µ—Å—Å–∫–∏–π": { km: 240, price: 2000 },
    "–£–≥–ª–∏—á": { km: 200, price: 1800 },
    "–†–æ—Å—Ç–æ–≤": { km: 120, price: 1200 },
    "–ì–∞–≤—Ä–∏–ª–æ–≤ –Ø–º": { km: 80, price: 1000 },
    "–î–∞–Ω–∏–ª–æ–≤": { km: 140, price: 1400 },
    "–ü–æ—à–µ—Ö–æ–Ω—å–µ": { km: 280, price: 2500 },
    "–ú—ã—à–∫–∏–Ω": { km: 200, price: 1800 },
    "–õ—é–±–∏–º": { km: 180, price: 1600 }
  },
  "–ö–æ—Å—Ç—Ä–æ–º—Å–∫–∞—è": {
    "–ö–æ—Å—Ç—Ä–æ–º–∞": { km: 180, price: 1600 },
    "–®–∞—Ä—å—è": { km: 400, price: 3500 },
    "–ù–µ—Ä–µ—Ö—Ç–∞": { km: 200, price: 1800 },
    "–ë—É–π": { km: 320, price: 2800 },
    "–í–æ–ª–≥–æ—Ä–µ—á–µ–Ω—Å–∫": { km: 200, price: 1800 },
    "–ú–∞–Ω—Ç—É—Ä–æ–≤–æ": { km: 380, price: 3300 },
    "–ì–∞–ª–∏—á": { km: 280, price: 2500 }
  },
  "–ò–≤–∞–Ω–æ–≤—Å–∫–∞—è": {
    "–ò–≤–∞–Ω–æ–≤–æ": { km: 160, price: 1500 },
    "–ö–∏–Ω–µ—à–º–∞": { km: 240, price: 2100 },
    "–®—É—è": { km: 200, price: 1800 },
    "–¢–µ–π–∫–æ–≤–æ": { km: 180, price: 1600 },
    "–ö–æ—Ö–º–∞": { km: 180, price: 1600 },
    "–í–∏—á—É–≥–∞": { km: 220, price: 2000 },
    "–§—É—Ä–º–∞–Ω–æ–≤": { km: 200, price: 1800 },
    "–†–æ–¥–Ω–∏–∫–∏": { km: 220, price: 2000 },
    "–ü—Ä–∏–≤–æ–ª–∂—Å–∫": { km: 180, price: 1600 },
    "–Æ–∂–∞": { km: 260, price: 2300 }
  },
  "–í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∞—è": {
    "–í–ª–∞–¥–∏–º–∏—Ä": { km: 360, price: 3100 },
    "–ö–æ–≤—Ä–æ–≤": { km: 380, price: 3300 },
    "–ú—É—Ä–æ–º": { km: 480, price: 4200 },
    "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤": { km: 360, price: 3100 },
    "–ì—É—Å—å —Ö—Ä—É—Å—Ç–∞–ª—å–Ω—ã–π": { km: 420, price: 3700 }
  },
  "–í–æ–ª–æ–≥–æ–¥—Å–∫–∞—è": {
    "–í–æ–ª–æ–≥–¥–∞": { km: 500, price: 4400 },
    "–ß–µ—Ä–µ–ø–æ–≤–µ—Ü": { km: 640, price: 5600 },
    "–°–æ–∫–æ–ª": { km: 520, price: 4600 }
  }
};

// –î–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥
const services = {
  "–î–µ—Ç—Å–∫–æ–µ —à–æ—É (30 –º–∏–Ω—É—Ç)": 7500,
  "–î–µ—Ç—Å–∫–æ–µ —à–æ—É (40 –º–∏–Ω—É—Ç)": 9500,
  "–ò–Ω–¥–∏–≤. –¥–µ—Ç—Å–∫–æ–µ —à–æ—É (30 –º–∏–Ω)": 14000,
  "–í–∑—Ä–æ—Å–ª–æ–µ —à–æ—É (20 –º–∏–Ω—É—Ç)": 13000,
  "–í–∑—Ä–æ—Å–ª–æ–µ —à–æ—É (30 –º–∏–Ω—É—Ç)": 19000,
  "–í–∑—Ä–æ—Å–ª–æ–µ —à–æ—É (40 –º–∏–Ω—É—Ç)": 25000,
  "–ú–∏–∫—Ä–æ–º–∞–≥–∏—è (30 –º–∏–Ω)": 10000,
  "–ú–∏–∫—Ä–æ–º–∞–≥–∏—è (1 —á)": 18000,
  "–ú–∏–∫—Ä–æ–º–∞–≥–∏—è (2 —á)": 28000,
  "–ú–∏–∫—Ä–æ–º–∞–≥–∏—è (3 —á)": 34000,
  "–°–≤–∞–¥–µ–±–Ω–æ–µ —à–æ—É (20 –º–∏–Ω)": 19000,
  "–°–≤–∞–¥–µ–±–Ω–æ–µ —à–æ—É (30 –º–∏–Ω)": 26000,
  "–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤ (20 –º–∏–Ω)": 19000,
  "–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤ (30 –º–∏–Ω)": 26000,
  "–Æ–±–∏–ª–µ–π (20 –º–∏–Ω)": 17000,
  "–Æ–±–∏–ª–µ–π (30 –º–∏–Ω)": 24000,
  "–í—ã–ø—É—Å–∫–Ω–æ–π (20 –º–∏–Ω)": 17000,
  "–í—ã–ø—É—Å–∫–Ω–æ–π (30 –º–∏–Ω)": 24000,
  "–ú–∏–Ω–∏-—à–æ—É ¬´–°–ï–ö–†–ï–¢¬ª (1 —á)": 60000,
  "–°–ø–µ–∫—Ç–∞–∫–ª—å ¬´–°–ï–ö–†–ï–¢¬ª (2 —á)": 100000
};

const areaSelect = document.getElementById('area');
const citySelect = document.getElementById('city');
const serviceSelect = document.getElementById('service');
const result = document.getElementById('result');
const totalPrice = document.getElementById('totalPrice');
const breakdown = document.getElementById('breakdown');

// –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±–ª–∞—Å—Ç–∏
Object.keys(logistics).forEach(area => {
  const option = document.createElement('option');
  option.value = area;
  option.textContent = area;
  areaSelect.appendChild(option);
});

// –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —É—Å–ª—É–≥
Object.keys(services).forEach(service => {
  const option = document.createElement('option');
  option.value = service;
  option.textContent = service;
  serviceSelect.appendChild(option);
});

// –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –æ–±–ª–∞—Å—Ç–∏ - –∑–∞–ø–æ–ª–Ω—è–µ–º –≥–æ—Ä–æ–¥–∞
areaSelect.addEventListener('change', () => {
  citySelect.innerHTML = '<option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>';
  citySelect.disabled = false;
  
  const cities = logistics[areaSelect.value];
  Object.keys(cities).forEach(city => {
    const option = document.createElement('option');
    option.value = city;
    option.textContent = city;
    citySelect.appendChild(option);
  });
  
  // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –≥–æ—Ä–æ–¥–∞
  setTimeout(() => citySelect.focus(), 100);
  
  calculate();
});

// –ü–µ—Ä–µ—Å—á—ë—Ç –ø—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
citySelect.addEventListener('change', () => {
  calculate();
  // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ —É—Å–ª—É–≥—É
  setTimeout(() => serviceSelect.focus(), 100);
});

serviceSelect.addEventListener('change', calculate);

function calculate() {
  const area = areaSelect.value;
  const city = citySelect.value;
  const service = serviceSelect.value;
  
  if (!area || !city || !service) {
    result.classList.remove('show');
    return;
  }
  
  const servicePrice = services[service];
  const cityData = logistics[area][city];
  const roadPrice = cityData.price;
  
  const total = servicePrice + roadPrice;
  
  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
  const fmt = (n) => n.toLocaleString('ru-RU');
  
  totalPrice.textContent = `${fmt(total)} ‚ÇΩ`;
  totalPrice.classList.add('pulse');
  setTimeout(() => totalPrice.classList.remove('pulse'), 500);
  
  breakdown.innerHTML = `
    <div class="breakdown-item">
      <span class="label-text">–£—Å–ª—É–≥–∞:</span>
      <span class="value-text">${fmt(servicePrice)} ‚ÇΩ</span>
    </div>
    <div class="breakdown-item">
      <span class="label-text">–î–æ—Ä–æ–≥–∞:</span>
      <span class="value-text">${roadPrice === 0 ? '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' : fmt(roadPrice) + ' ‚ÇΩ'}</span>
    </div>
    <div class="breakdown-item">
      <span class="label-text">–ò–¢–û–ì–û:</span>
      <span class="value-text">${fmt(total)} ‚ÇΩ</span>
    </div>
  `;
  
  result.classList.add('show');
  
  // –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
  setTimeout(() => {
    result.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }, 100);
}

// iOS viewport height fix
function setVH() {
  document.documentElement.style.setProperty('--vh', `${window.innerHeight}px`);
}
setVH();
window.addEventListener('resize', setVH);
window.addEventListener('orientationchange', setVH);

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js')
      .then(reg => console.log('‚úÖ SW registered'))
      .catch(err => console.log('‚ùå SW failed:', err));
  });
}

// –û—Ñ–ª–∞–π–Ω –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
const offlineBadge = document.getElementById('offlineBadge');

function updateOnlineStatus() {
  if (!navigator.onLine) {
    offlineBadge.classList.add('show');
  } else {
    offlineBadge.classList.remove('show');
  }
}

window.addEventListener('online', updateOnlineStatus);
window.addEventListener('offline', updateOnlineStatus);
updateOnlineStatus();
</script>

</body>
</html>
